<template>
  <main data-testid="checkout-layout">
    <NuxtLazyHydrate when-visible>
      <NarrowContainer class="px-4 md:px-0 mb-20">
        <div class="flex items-center justify-between mt-8 mb-10 px-4 md:px-0">
          <h1 class="font-bold typography-headline-3 md:typography-headline-2">{{ heading }}</h1>
          <SfButton
            v-if="!isTablet"
            :tag="NuxtLink"
            :to="localePath(backHref)"
            class="flex md:hidden whitespace-nowrap"
            size="sm"
            variant="tertiary"
          >
            <template #prefix>
              <SfIconArrowBack />
            </template>
            {{ backLabelMobile }}
          </SfButton>

          <SfButton v-else :tag="NuxtLink" :to="localePath(backHref)" class="hidden md:flex" variant="tertiary">
            <template #prefix>
              <SfIconArrowBack />
            </template>
            {{ backLabelDesktop }}
          </SfButton>
        </div>
        <span class="!flex justify-center my-40 h-24" v-if="isLoading && !cart">
          <SfLoaderCircular size="2xl" />
        </span>
        <slot v-else />
      </NarrowContainer>
    </NuxtLazyHydrate>
  </main>
</template>

<script setup lang="ts">
import { SfButton, SfIconArrowBack, SfLoaderCircular } from '@storefront-ui/vue';

const localePath = useLocalePath();
const { data: cart, loading: isLoading } = useCart();
const { setInitialData } = useInitialSetup();
const { isTablet } = useBreakpoints();

setInitialData();

defineProps<{
  backLabelDesktop: string;
  backLabelMobile: string;
  backHref: string;
  heading: string;
}>();

const NuxtLink = resolveComponent('NuxtLink');
</script>
