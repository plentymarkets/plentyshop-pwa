<template>
  <div class="flex items-center">
    <SfCheckbox
      v-if="!productPropertyGetters.isOrderPropertyHidden(productProperty)"
      :id="`prop-${productPropertyGetters.getOrderPropertyId(productProperty)}`"
      v-model="value"
      class="mr-2"
    />

    <div class="flex items-center">
      <label
        class="cursor-pointer peer-disabled:text-disabled-900"
        :for="`prop-${productPropertyGetters.getOrderPropertyId(productProperty)}`"
      >
        {{ productPropertyGetters.getOrderPropertyName(productProperty) }}
        <span v-if="productPropertyGetters.getOrderPropertyLabel(productProperty).surchargeType">
          ({{
            $t('orderProperties.vat.' + productPropertyGetters.getOrderPropertyLabel(productProperty).surchargeType)
          }}
          {{ $n(productPropertyGetters.getOrderPropertySurcharge(productProperty), 'currency') }})
        </span>
        {{ productPropertyGetters.getOrderPropertyLabel(productProperty).surchargeIndicator }}
        <span
          v-if="
            productPropertyGetters.getOrderPropertyLabel(productProperty).surchargeIndicator &&
            productPropertyGetters.getOrderPropertyLabel(productProperty).requiredIndicator
          "
        >
          ,
        </span>
        {{ productPropertyGetters.getOrderPropertyLabel(productProperty).requiredIndicator }}
      </label>

      <div v-if="hasTooltip" class="w-[28px]">
        <slot name="tooltip" />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { productPropertyGetters } from '@plentymarkets/shop-sdk';
import { OrderPropertyCheckboxProps } from './types';
import { SfCheckbox } from '@storefront-ui/vue';

const props = defineProps<OrderPropertyCheckboxProps>();
const productProperty = props.productProperty;
const hasTooltip = props.hasTooltip;
const { getPropertyById } = useProductOrderProperties();

const property = getPropertyById(productProperty.property.id);
const value = ref<boolean>(productProperty.property.isPreSelected);

if (property?.property) {
  property.property.value = productProperty.property.isPreSelected ? 'true' : null;
}

watch(
  () => value.value,
  (updatedValue) => {
    if (property) {
      property.property.value = updatedValue ? 'true' : null;
    }
  },
);
</script>
